<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <form action="/ocr" method="POST" enctype="multipart/form-data" id="form">
      <input type="file" accept="image/*" id="ocr" name="ocr" />
      <input type="submit" value="OCR" />
    </form>
    <div id="result"></div>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/compressorjs/1.0.7/compressor.min.js"
      integrity="sha512-ZNlHFR9FBdeIlhwh040g5JmmYj7DQOwkqb9Y+DBJ1MaTzRMxKZkfHWkQU/dazDn9XRriajfh7ZGFksBKeUCsCg=="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"
      integrity="sha512-bZS47S7sPOxkjU/4Bt0zrhEtWx0y0CRkhEp8IckzK+ltifIIE9EMIMTuT/mEzoIMewUINruDBIR/jJnbguonqQ=="
      crossorigin="anonymous"
    ></script>
    <script>
      const form = document.getElementById("form");
      const fileInput = document.getElementById("ocr");
      const resultContainer = document.getElementById("result");
      form.addEventListener("submit", (e) => {
        e.preventDefault();

        const file = fileInput.files[0];
        console.log(file);
        if (!file) {
          return;
        }
        new Compressor(file, {
          quality: 0.2,

          // The compression process is asynchronous,
          // which means you have to access the `result` in the `success` hook function.
          success(result) {
            const formData = new FormData();

            // The third parameter is required for server
            formData.append("file", result, result.name);

            // Send the compressed image file to server with XMLHttpRequest.
            axios.post("/ocr", formData).then((response) => {
              console.log(response);
              console.log("Upload success");
              resultContainer.innerHTML = response.data;
            });
          },
          error(err) {
            console.log(err.message);
          },
        });
      });
    </script>
  </body>
</html>
